(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/chat/chat"],{"0bd7":function(t,e,n){"use strict";var o,a=function(){var t=this,e=t.$createElement;t._self._c},i=[];n.d(e,"b",function(){return a}),n.d(e,"c",function(){return i}),n.d(e,"a",function(){return o})},"1a3f":function(t,e,n){"use strict";n.r(e);var o=n("0bd7"),a=n("80de");for(var i in a)"default"!==i&&function(t){n.d(e,t,function(){return a[t]})}(i);n("e286");var s,c=n("f0c5"),r=Object(c["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],s);e["default"]=r.exports},"23d3":function(t,e,n){"use strict";(function(t){n("69e0"),n("921b");o(n("66fd"));var e=o(n("1a3f"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("6e42")["createPage"])},"80de":function(t,e,n){"use strict";n.r(e);var o=n("b40f"),a=n.n(o);for(var i in o)"default"!==i&&function(t){n.d(e,t,function(){return o[t]})}(i);e["default"]=a.a},a8dd:function(t,e,n){},b40f:function(t,e,n){"use strict";(function(t,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o={data:function(){return{username:this.$store.state.userInfo.inviteCode,my_avatar:this.$store.state.userInfo.wexinImg,chater_info:null,Chat_Record:[],my_say_text:"",InputBottom:0,Time_now:{Date:"",Y:"",M:"",D:"",h:"",m:"",s:""},userId:this.$store.state.userInfo.userId,nick_name:this.$store.state.userInfo.wexinNickName,nick_image:this.$store.state.userInfo.wexinImg,list:30}},onLoad:function(){this.Times_now(),this.load_chater_info(),this.to_bottom(),this.enterChatroom(),this.onRoomMsg(),this.liaotianRecord()},onShow:function(){this.to_bottom()},methods:{hump2Underline:function(t){return t.replace(/([A-Z])/g,"_$1").toLowerCase()},jsonToUnderline:function(t){var e=this;t instanceof Array?t.forEach(function(t,n){e.jsonToUnderline(t)}):t instanceof Object&&Object.keys(t).forEach(function(n){var o=e.hump2Underline(n);o!==n&&(t[o]=t[n],delete t[n]),e.jsonToUnderline(t[o])})},load_chater_info:function(){var e,o=this;e=t.getStorageSync("chater_info"),o.chater_info=e,n("log","聊天室信息",e," at pages\\chat\\chat.vue:118"),t.setNavigationBarTitle({title:e.name}),this.onRoomMsg(),o.to_bottom()},onRoomMsg:function(){var t=this;this.JIM.onRoomMsg(function(e){n("log","聊天室信息监听"," at pages\\chat\\chat.vue:133"),n("log",e," at pages\\chat\\chat.vue:134"),t.Chat_Record.push(e.content);for(var o=0;o<t.Chat_Record.length;o++)t.get_message_time(t.Chat_Record[o].create_time,o);n("log",t.Chat_Record," at pages\\chat\\chat.vue:141")})},to_bottom:function(){setTimeout(function(){t.pageScrollTo({scrollTop:3e3})},1e3)},Times_now:function(){var t=this,e=new Date,n=e.getFullYear()+"-",o=(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-",a=(e.getDate()<10?"0"+e.getDate():e.getDate())+" ",i=(e.getHours()<10?"0"+e.getHours():e.getHours())+":",s=(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+"",c=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds();t.Time_now.Date=e,t.Time_now.Y=n,t.Time_now.M=o,t.Time_now.D=a,t.Time_now.h=i,t.Time_now.m=s,t.Time_now.s=c},get_message_time:function(t,e){var n=this,o=n.Time_now,a=new Date(t),i=a.getFullYear()+"-",s=(a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1)+"-",c=(a.getDate()<10?"0"+a.getDate():a.getDate())+" ",r=(a.getHours()<10?"0"+a.getHours():a.getHours())+":",u=(a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes())+"";a.getSeconds(),a.getSeconds();i==o.Y&&s==o.M&&c==o.D?n.Chat_Record[e].timess=r+u:n.Chat_Record[e].timess=s+c},enterChatroom:function(){var t=this;this.JIM.enterChatroom({id:t.chater_info.id}).onSuccess(function(t){n("log","进入聊天室成功：",JSON.stringify(t)," at pages\\chat\\chat.vue:195")}).onFail(function(t){})},to_send:function(){var e=this,o=e.my_say_text;o&&""!=o&&(n("log",e.Chat_Record," at pages\\chat\\chat.vue:214"),this.JIM.sendChatroomMsg({target_rid:e.chater_info.id,content:o,extras:{userId:e.userId,nick_name:e.nick_name,nick_image:e.nick_image}}).onSuccess(function(t,o){n("log","发送消息data",JSON.stringify(t)," at pages\\chat\\chat.vue:226"),n("log","发送消息msg",JSON.stringify(o)," at pages\\chat\\chat.vue:227"),e.Times_now(),o.content.timess=e.Time_now.h+e.Time_now.m,e.Chat_Record.push(o.content),e.my_say_text="",e.to_bottom()}).onFail(function(e){t.showToast({title:"发送失败"})}))},liaotianRecord:function(){self=this,t.request({url:this.websiteUrl+"/api/jim/getMessageList?roomId="+self.chater_info.id+"&count="+self.list,method:"GET",success:function(t){n("log",t," at pages\\chat\\chat.vue:253"),self.jsonToUnderline(t.data),self.Chat_Record=t.data,self.list+=self.list}})},onPullDownRefresh:function(){this.liaotianRecord(),setTimeout(function(){t.stopPullDownRefresh()},1e3)},InputFocus:function(t){this.InputBottom=t.detail.height},InputBlur:function(t){this.InputBottom=0}}};e.default=o}).call(this,n("6e42")["default"],n("0de9")["default"])},e286:function(t,e,n){"use strict";var o=n("a8dd"),a=n.n(o);a.a}},[["23d3","common/runtime","common/vendor"]]]);